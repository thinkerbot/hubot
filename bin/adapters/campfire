#!/bin/bash

MY_DIR="$( cd "$( dirname $0 )" && pwd)"

LOGIN="$MY_DIR/_campfire/login"
LISTEN="$MY_DIR/_campfire/listen"
SAY="$MY_DIR/_campfire/say"

if [ ! -e $LOGIN ]
then
    echo "Campfire login command not found: $LOGIN"
    exit 1
fi

if [ ! -e $LISTEN ]
then
    echo "Campfire listen command not found: $LISTEN"
    exit 1
fi

if [ ! -e $SAY ]
then
    echo "Campfire say command not found: $SAY"
    exit 1
fi

$LOGIN

$LISTEN | while read -r input_line
do
    list_plugins
    for plugin in $PLUGINS
    do
        # Plugins are executed in parallel
        $plugin "$input_line" | $SAY &
    done
done
